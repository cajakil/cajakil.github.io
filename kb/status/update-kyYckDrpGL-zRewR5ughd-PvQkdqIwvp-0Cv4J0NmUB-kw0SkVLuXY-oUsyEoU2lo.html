<!DOCTYPE html>
<html>
<head>
  <title>Update keyboard status (admin)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
<style>
  .wrapper {
    padding : 5px;

    font-family: sans-serif;
    text-align: center;
  }
  .title {
    font-size: 14pt;

    color: rgba(26,115,232,1);
    font-series: bold;
  }
  .info {

  }
  </style>
  <script>var debug = false
  </script>
  </head>
  <body>
    <div class="wrapper">
<!-- <div class="header">Keyboard helper admin</div> -->
  <h1 class="title">Keyboard status: scan QR code</h1>
<!-- <div class="info">Scan QR code to open status update form</div> -->
<!-- <div style="height:20px"></div> -->
<select id="deliv-opts">
  <option value="none">If delivery, choose name</option>
</select>
<script src="./getDueDeliv.js" type="module">
</script>
<p id="result"></p>
<div id="qr-reader" style="width:280px;margin:auto;"></div>
</div>
<!-- <div id="qr-reader-results" style="width:360px"></div> -->
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<script>
var resultContainer = document.getElementById('qr-reader-results');
var lastResult, countResults = 0;
var keyboardIds = [
"sCDwGuEcuM",
"IWJmE117oB",
"GbB8ejA34r",
"JuXMTBbtTl",
"MjX8aGXdsJ",
"fV8gfTYucM",
"LmiN3HnYI0",
"EABqdAcDfQ",
"GLWF3rKsql",
"EYloYnAq7F",
"SX922HL9C6",
"Iwi0pRc6Zq",
"XlUxeqGkw8",
"ZteSZbfOoP",
"e8WbU4Zipj",
"Y3bmOm9w01",
"zeb7BNkRzI",
"uvIiE5RKtt",
"aodYpImW6J",
"Tlo1Y6HkGN"]
formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSe7903_DmMBcSoZRzVoVckXfYcvlOXw1hs-iE5qM0To9UbyjQ/viewform?entry.471244016=*kbNum**recip*#i5"

function onScanSuccess(qrCodeMessage) {
    // if (qrCodeMessage !== lastResult) {
    //     ++countResults;
    //     lastResult = qrCodeMessage;
    //     resultContainer.innerHTML
    //         += `<div>[${countResults}] - ${qrCodeMessage}</div>`;
    // }
    var kbId = qrCodeMessage.slice(-10);
    var kbNum = keyboardIds.indexOf(kbId) + 1;
    var chosenName = document.getElementById("deliv-opts").value
    if (chosenName == "none") {
      var recipBit = ""
    }
    else {
      var recipBit = "&entry.425118090=Delivered&entry.1836097853="+encodeURIComponent(chosenName)
    }
    var thisFormUrl = formUrl.replace("*recip*",recipBit);
    if (debug == true) {
      alert(thisFormUrl.replace("*kbNum*",kbNum))
    }
    else {
      window.location.href = thisFormUrl.replace("*kbNum*",kbNum);
    }
}

// https://github.com/mebjas/html5-qrcode#for-using-inline-qr-code-scanning-with-webcam-or-smartphone-camera
const html5QrCode = new Html5Qrcode("qr-reader");
const qrCodeSuccessCallback = message => { onScanSuccess(message) }
const config = { fps: 10, qrbox: 200 };

// If you want to prefer back camera
html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback);
</script>
</body>
</html>
